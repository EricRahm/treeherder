<div ng-controller="ClassificationPluginCtrl"
     class="error-classification-content">
  <ul class="list-unstyled failure-line-list">

    <button ng-if="failureLines"
            class="btn btn-xs btn-default"
            title="Save All"
            ng-disabled="!canSaveAll(line)"
            ng-click="saveAll()">Save All</button>

    <li ng-repeat="line in failureLines"
        class="failure-line"
        ng-class="{'classified-line': line.best_classification }">
      <button ng-if="!line.best_is_verified"
              class="btn btn-xs btn-default"
              title="Select best match and click here"
              ng-disabled="!canSave(line)"
              ng-click="save(line)">{{getSaveButtonText(line)}}</button>
      <span ng-if="line.best_is_verified"
            class="label label-xs label-primary"
            title="This classification is already verified">Verified</span>
      <span><strong>{{line | classified}}</strong></span>
      <span ng-if="line.action === 'test_result'">
        <span>{{line.test}} {{line.subtest}}
          Expected: <strong>{{line.expected}}</strong>, got: <strong>{{line.status}}</strong>
        </span>
        <div ng-if="line.message"
             ng-init="messageExpanded=false"
             class="failure-line-message">
             <span class="failure-line-message-toggle fa fa-fw fa-lg"
                   ng-class="{'fa-caret-down': messageExpanded, 'fa-caret-right': !messageExpanded}"
                   ng-click="messageExpanded = !messageExpanded"></span>
             <span ng-if="!messageExpanded"
                   class="failure-line-message-collapsed">{{ line.message }}</span>
             <span ng-if="messageExpanded"
                   class="failure-line-message-expanded">{{ line.message }}</span>
        </div>
      </span>
      <span ng-if="line.action === 'log'">
        LOG {{line.level}} | {{line.message}}
      </span>
      <span ng-if="line.action === 'crash'">
        CRASH | {{line.signature}}
      </span>
      <span ng-if="line.action === ''">
        CRASH | {{line.signature}}
      </span>

      <div ng-if="line.best_is_verified">
            <span class="glyphicon glyphicon-star best-classification-star"></span>
            <span class="line-option-text" ng-if="line.ui.best.bug_number">
              <a href="{{::getBugUrl(line.ui.best.bug_number) }}"
                 target="_blank">Bug {{::line.ui.best.bug_number}} - <span ng-bind-html="line.ui.best.bug_summary | escapeHTML"></span>
              </a>
            </span>
      </div>

      <ul class="list-unstyled"
          ng-if="!line.best_is_verified">
        <!--classification options for line-->
        <li ng-repeat="option in line.ui.options" >
          <div class="classification-options">
            <span ng-if="option.icon_type == 'autoclassified'"
                  class="glyphicon glyphicon-star-empty best-classification-star"
                  title="This is the option Treeherder chose as the best"></span>
            <span ng-if="option.icon_type == 'set_bug'"
                  class="glyphicon glyphicon-pushpin classification-set-bug"
                  ng-click="setAutoclassifiedBugNumber(line, option.bug_number)"
                  title="Use bug number for best classification"
                  ></span>
            <span ng-if="option.icon_type == 'none'"
                  class="classification-no-icon">&nbsp;</span>
            <input type="radio"
                   value="{{$index}}"
                   name="{{::line.id}}"
                   ng-model="line.ui.selectedOption" />
            <span class="line-option-text" ng-if="option.bug_number">
              <a href="{{::getBugUrl(option.bug_number) }}"
                 target="_blank">Bug {{::option.bug_number}} - <span ng-bind-html="option.bug_summary | escapeHTML"></span>
              </a>
            </span>
            <span ng-if="!option.bug_number">
              <input class="manual-bug-input"
                     type="text"
                     placeholder="Enter a bug number"
                     title="This 'best match' does not yet have a bug number.  Please enter one."
                     ng-model="manualBugs[line.id]"/>
            </span>
          </div>
          <div class="classification-matchers" ng-if="option.type == 'classified_failure'">
            Matched by:
            <span ng-repeat='match in option.matches'>
              {{match.matcher.name}} ({{match.score}})
            </span>
            <a target="th_similar" ng-href="/api/classified-failure/{{option.id}}/matches">Othermatching failures...</a>
          </div>
        </li>
      </ul>
    </li>

    <li ng-if="!tabs.autoClassification.is_loading &&  !failureLines.length">
      <span>No classifiable errors for this job.</span>
    </li>
  </ul>
</div>
