<div ng-controller="ClassificationPluginCtrl"
     class="error-classification-content">
  <ul class="list-unstyled failure-line-list">

    <li ng-repeat="line in failureLines"
        class="failure-line"
        ng-class="{'classified-line': line.best_classification }">
      <button ng-if="!line.best_is_verified"
              class="btn btn-xs btn-default"
              title="Requires verification - select best match and click here"
              ng-click="verifyBest(line)">Verify</button>
      <span ng-if="line.best_is_verified"
            class="label label-xs label-primary"
            title="This classification is already verified">Verified</span>
      <span><strong>{{line | classified}}</strong></span>
      <span ng-if="line.action === 'test_result'">
        <span>{{line.test}} {{line.subtest}}
          Expected: <strong>{{line.expected}}</strong>, got: <strong>{{line.status}}</strong>
        </span>
        <div ng-if="line.message"
             ng-init="messageExpanded=false"
             class="failure-line-message">
             <span class="failure-line-message-toggle fa fa-fw fa-lg"
                   ng-class="{'fa-caret-down': messageExpanded, 'fa-caret-right': !messageExpanded}"
                   ng-click="messageExpanded = !messageExpanded"></span>
             <span ng-if="!messageExpanded"
                   class="failure-line-message-collapsed">{{ line.message }}</span>
             <span ng-if="messageExpanded"
                   class="failure-line-message-expanded">{{ line.message }}</span>
        </div>
      </span>
      <span ng-if="line.action === 'log'">
        LOG {{line.level}} | {{line.message}}
      </span>
      <span ng-if="line.action === 'crash'">
        CRASH | {{line.signature}}
      </span>
      <span ng-if="line.action === ''">
        CRASH | {{line.signature}}
      </span>

      <span ng-if="line.best_is_verified">
            <span class="glyphicon glyphicon-star-empty"></span>
            <span class="line-option-text" ng-if="line.best.bug_number">
              <a href="{{::getBugUrl(line.best.bug_number) }}"
                 target="_blank">Bug {{::line.best.bug_number}} - <span ng-bind-html="line.best.bug_summary | escapeHTML"></span>
              </a>
            </span>

      </span>
      <ul class="list-unstyled"
          ng-if="!line.best_is_verified">
        <!--classification options for line-->
        <li ng-repeat="option in lineClassificationOptions[line.id]" >
          <span ng-class="{'classification-options-best': option.best, 'classification-options': !option.best}">
            <span ng-if="option.best" class="glyphicon glyphicon-star-empty"></span>
            <input type="radio"
                   value="{{option.id}}"
                   name="{{::line.id}}"
                   ng-model="lineSelection[line.id]" />
            <span class="line-option-text" ng-if="option.bug_number">
              <a href="{{::getBugUrl(option.bug_number) }}"
                 target="_blank">Bug {{::option.bug_number}} - <span ng-bind-html="option.bug_summary | escapeHTML"></span>
              </a>
            </span>
              <span ng-if="!option.bug_number">
                <input class="manual-bug-input"
                       type="text"
                       placeholder="Enter a bug number"
                       title="This 'best match' does not yet have a bug number.  Please enter one."
                       ng-model="manualBugs[line.id]"/>
              </span>
          </span>
        </li>
      </ul>
    </li>

    <li ng-if="!tabs.autoClassification.is_loading &&  !failureLines.length">
      <span>No classifiable errors for this job.</span>
    </li>
  </ul>
</div>
